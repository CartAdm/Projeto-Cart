<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutomatizaÃ§Ã£o com Excel - Tema Escuro</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --text-color: #f9f9f9;
            --table-bg: #2a2a2a;
            --button-bg: #444;
            --button-hover: #666;
            --border-color: #555;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            text-align: center;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--table-bg);
            margin: 20px 0;
        }

        th, td {
            padding: 10px;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        th {
            background-color: var(--button-bg);
            color: var(--text-color);
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            background-color: var(--button-bg);
            color: var(--text-color);
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px;
            border: none;
            background-color: var(--button-bg);
            color: var(--text-color);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .theme-toggle:hover {
            background-color: var(--button-hover);
            transform: scale(1.1);
        }

        .column-controls-container {
            margin: 20px;
            background-color: var(--table-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }

        .column-controls-title {
            padding: 10px;
            cursor: pointer;
            background-color: var(--button-bg);
            color: var(--text-color);
        }

        .column-controls-content {
            display: none;
            padding: 10px;
        }

        .column-controls label {
            display: block;
            margin: 5px 0;
            color: var(--text-color);
        }

        .column-controls input[type="checkbox"],
        .column-controls input[type="text"] {
            margin-right: 5px;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            background-color: var(--table-bg);
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
    <h1>AutomatizaÃ§Ã£o com Tema Escuro</h1>

    <div>
        <input type="file" id="fileInput" accept=".xls,.xlsx" />
        <button onclick="carregarPlanilha()">Carregar Planilha</button>
    </div>

    <div class="column-controls-container">
        <div class="column-controls-title" onclick="toggleColumnControls()">Configurar Colunas</div>
        <div class="column-controls-content" id="columnControls">
            <div id="columnSelector"></div>
        </div>
    </div>

    <table id="baseTable">
        <thead>
            <tr id="tableHeaders">
                <!-- CabeÃ§alhos dinÃ¢micos serÃ£o preenchidos -->
            </tr>
        </thead>
        <tbody>
            <!-- Dados carregados do Excel serÃ£o exibidos -->
        </tbody>
    </table>

    <script>
        let excelData = [];
        let columnNames = [];

        function carregarPlanilha() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecione um arquivo Excel.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                excelData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                columnNames = excelData[0]; // Usar a primeira linha como cabeÃ§alhos
                excelData.shift(); // Remover cabeÃ§alhos dos dados

                excluirColunasVazias();
                preencherTabela();
                configurarSelecaoDeColunas();
            };

            reader.readAsArrayBuffer(file);
        }

        function excluirColunasVazias() {
            // Identificar colunas que estÃ£o completamente vazias
            const colunasNaoVazias = columnNames.map((_, index) => {
                return excelData.some(row => row[index] !== undefined && row[index] !== null && row[index] !== '');
            });

            // Filtrar apenas as colunas nÃ£o vazias
            columnNames = columnNames.filter((_, index) => colunasNaoVazias[index]);
            excelData = excelData.map(row => row.filter((_, index) => colunasNaoVazias[index]));
        }

        function preencherTabela() {
            const tableHeaders = document.getElementById('tableHeaders');
            const tableBody = document.getElementById('baseTable').querySelector('tbody');

            tableHeaders.innerHTML = '';
            tableBody.innerHTML = '';

            columnNames.forEach((colName) => {
                const th = document.createElement('th');
                th.textContent = colName;
                tableHeaders.appendChild(th);
            });

            excelData.forEach((row) => {
                const tr = document.createElement('tr');
                row.forEach((cell) => {
                    const td = document.createElement('td');
                    td.textContent = cell || '';
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        function configurarSelecaoDeColunas() {
            const columnSelector = document.getElementById('columnSelector');
            columnSelector.innerHTML = ''; // Limpar seletores

            columnNames.forEach((colName, index) => {
                const label = document.createElement('label');
                
                // Checkbox para mostrar/ocultar colunas
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = true;
                checkbox.onchange = () => toggleColuna(index, checkbox.checked);
                
                // Campo para alterar o nome da coluna
                const input = document.createElement('input');
                input.type = 'text';
                input.value = colName;
                input.onchange = () => atualizarNomeColuna(index, input.value);
                
                label.appendChild(checkbox);
                label.appendChild(input);
                columnSelector.appendChild(label);
            });
        }

        function toggleColuna(colIndex, isVisible) {
            const headers = document.querySelectorAll('#tableHeaders th');
            const rows = document.querySelectorAll('#baseTable tr');

            if (headers[colIndex]) headers[colIndex].style.display = isVisible ? '' : 'none';

            rows.forEach((row) => {
                const cells = row.cells;
                if (cells[colIndex]) cells[colIndex].style.display = isVisible ? '' : 'none';
            });
        }

        function atualizarNomeColuna(index, novoNome) {
            columnNames[index] = novoNome;
            preencherTabela();
            configurarSelecaoDeColunas();
        }

        function toggleTheme() {
            const root = document.documentElement;
            const isDark = root.style.getPropertyValue('--bg-color') === '#1e1e1e';
            root.style.setProperty('--bg-color', isDark ? '#f9f9f9' : '#1e1e1e');
            root.style.setProperty('--text-color', isDark ? '#333' : '#f9f9f9');
            root.style.setProperty('--table-bg', isDark ? '#fff' : '#2a2a2a');
        }

        function toggleColumnControls() {
            const controls = document.getElementById('columnControls');
            controls.style.display = controls.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
